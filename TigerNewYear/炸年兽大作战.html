<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
		<title>炸年兽大作战</title>
		<style>
			#stage{
				width: 100%;
			}
			#monster {
				width: 48px;
				height: 48px;
				background-color: red;
				position: fixed;
				top: 90px;
				left: 0px;
			}
			.monster:after{
			  content:'';
			  position:absolute;
			  z-index:1;
			  top:68px;
			  left:4px;
			  width:44px;
			  height:10px;
			  background:#eaeaea;
			  border-radius:100%;
			}
			#Launcher {
				width: 108px;
				height: 108px;
				/* background-color: red; */
				background: url(image/Launcher.png) 0 0 no-repeat;
				/* background: url(allnormal.png); */
				background-size: 100% 100%;
				background-position: center center;
				overflow: auto;
				z-index: 9999;
				position: fixed;
				bottom: 0;
				left: 46%;
				-moz-transform-origin: 50% 100%;
				-webkit-transform-origin:50% 100%;
				-o-transform-origin:50% 100%;
			}
			.bullet {
			  position: absolute;
			  width: 10px;
			  height: 16px;
			  background-image: linear-gradient(to bottom, #ffee00, #ffe395);
			  /* border-radius: 50%; */
			  box-shadow: 0 0 5px #fff;
			  -moz-transform-origin: 50% 50%;
			  -webkit-transform-origin:50% 50%;
			  -o-transform-origin:50% 50%;
			}
			.imgF {
				position: absolute;
				width: 64px;
				height: 64px;
				background: url(image/explode.png) 0 0 no-repeat;
				-webkit-animation-iteration-count: 1;/* 动画播放 */
				-webkit-animation-timing-function:step-start;/* 马上跳到动画每一结束桢的状态 */
				-webkit-animation-name: person-fast;
				-webkit-animation-duration: 650ms;
			}
			@-webkit-keyframes person-fast{/* 快 */
			    0% {background-position: 0 0;}
			    6.25% {background-position: -64px 0;}
			    12.5% {background-position: -128px 0;}
			    18.75% {background-position: -192px 0;}
			    25% {background-position: -256px 0;}
			    31.25% {background-position: -64px -64px;}
			    37.5% {background-position: -128px -64px;}
				43.75% {background-position: -192px -64px;}
				50% {background-position: -256px -64px;}
				56.25% {background-position: -64px -128px;}
				62.50% {background-position: -128px -128px;}
				69.75% {background-position: -192px -128px;}
				75.25% {background-position: -256px -128px;}
				81.25% {background-position: -64px -192px;}
				87.5% {background-position: -128px -192px;}
				93.75% {background-position: -192px -192px;}
				100% {background-position: -256px -192px;}
			}
			body {
				background: url(image/tigerback.jpg) no-repeat center center fixed;
				-webkit-background-size: cover;
				-moz-background-size: cover;
				-o-background-size: cover;
				background-size: cover;
				overflow-x:hidden;
				overflow-y:hidden;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			#LauncherHead{
				background-color: #F4BD0A;
				z-index: 9999;
			}
			#container {
			    position: absolute;
			    top: 50%;
			    left: 50%;
			    -webkit-transform: translate(-50%, -50%);
			            transform: translate(-50%, -50%);
			    width: 100%;
			    height: 100%;
			}
			.firework-grp {
			    display: block;
			    width: 100%;
			    height: 100%;
			    position: absolute;
			}
			.firework {
			    font-size: 10px;
			    display: block;
			    width: 8.5em;
			    height: 8.5em;
			    position: absolute;
			}
			/*位置，颜色，大小都可调*/
			.pos1 {
			    left: 10%;
			    top: 5%;
			    color: #F44336;
			    -webkit-transform: scale(0.5);
			            transform: scale(0.5);
			}
			.pos2 {
			    left: 65%;
			    top: 10%;
			    color: #FFC107;
			    -webkit-transform: scale(0.6);
			            transform: scale(0.6);
			}
			.pos3 {
			    left: 60%;
			    top: 35%;
			    color: #F44336;
			    -webkit-transform: scale(0.8);
			            transform: scale(0.8);
			}
			.pos4 {
			    left: 15%;
			    top: 30%;
			    color: #FFC107;
			    -webkit-transform: scale(1);
			            transform: scale(1);
			}
			/*烟花*/
			.drops-grp {
			    display: block;
			    width: 8.5em;
			    height: 8.5em;
			    position: absolute;
			}
			.drops-grp2 {
			    display: block;
			    width: 8.5em;
			    height: 8.5em;
			    position: absolute;
			    -webkit-transform: rotate(45deg);
			            transform: rotate(45deg);
			}
			.drop {
			    display: block;
			    width: 1em;
			    height: 2em;
			    overflow: hidden;
			    position: absolute;
			    opacity: 0;
			}
			.drop:before {
			    content: "";
			    display: block;
			    width: 1em;
			    height: 1em;
			    background: currentColor;
			    border-radius: 50%;
			}
			 
			.drop:after {
			    content: "";
			    display: block;
			    position: relative;
			    top: -0.4em;
			    width: 0;
			    height: 0;
			    border-top: 1.4em solid currentColor;
			    border-left: 0.5em solid transparent;
			    border-right: 0.5em solid transparent;
			}
			/*烟花绽放的速度，次数，方式也可以调节*/
			.drop-1 {
			    left: 3.75em;
			    top: 0;
			    -webkit-animation: drop1anim 1.5s ease-in-out infinite;
			            animation: drop1anim 1.5s ease-in-out infinite;
			}
			.drop-2 {
			    top: 3.25em;
			    right: 0;
			    -webkit-animation: drop2anim 1.5s ease-in-out infinite;
			            animation: drop2anim 1.5s ease-in-out infinite;
			}
			.drop-3 {
			    left: 3.75em;
			    bottom: 0;
			    -webkit-animation: drop3anim 1.5s ease-in-out infinite;
			            animation: drop3anim 1.5s ease-in-out infinite;
			}
			.drop-4 {
			    top: 3.25em;
			    left: 0;
			    -webkit-animation: drop4anim 1.5s ease-in-out infinite;
			            animation: drop4anim 1.5s ease-in-out infinite;
			}
			/*延迟时间*/
			.delay1 .drop {
			    -webkit-animation-delay: 0.5s;
			            animation-delay: 0.5s
			}
			.delay2 .drop {
			    -webkit-animation-delay: 1s;
			            animation-delay: 1s
			}
			/*动画*/
			@-webkit-keyframes drop1anim {
			    0% {
			        top: 3.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3);
			                transform: scale(0.3);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1);
			                transform: scale(1);
			    }
			    100% {
			        top: -0.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3);
			                transform: scale(0.3);
			    }
			}
			 
			@keyframes drop1anim {
			    0% {
			        top: 3.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3);
			                transform: scale(0.3);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1);
			                transform: scale(1);
			    }
			    100% {
			        top: -0.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3);
			                transform: scale(0.3);
			    }
			}
			 
			@-webkit-keyframes drop2anim {
			    0% {
			        right: 3.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(90deg);
			                transform: scale(0.3) rotate(90deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(90deg);
			                transform: scale(1) rotate(90deg);
			    }
			    100% {
			        right: -0.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(90deg);
			                transform: scale(0.3) rotate(90deg);
			    }
			}
			 
			@keyframes drop2anim {
			    0% {
			        right: 3.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(90deg);
			                transform: scale(0.3) rotate(90deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(90deg);
			                transform: scale(1) rotate(90deg);
			    }
			    100% {
			        right: -0.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(90deg);
			                transform: scale(0.3) rotate(90deg);
			    }
			}
			 
			@-webkit-keyframes drop3anim {
			    0% {
			        bottom: 3.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(180deg);
			                transform: scale(0.3) rotate(180deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(180deg);
			                transform: scale(1) rotate(180deg);
			    }
			    100% {
			        bottom: -0.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(180deg);
			                transform: scale(0.3) rotate(180deg);
			    }
			}
			 
			@keyframes drop3anim {
			    0% {
			        bottom: 3.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(180deg);
			                transform: scale(0.3) rotate(180deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(180deg);
			                transform: scale(1) rotate(180deg);
			    }
			    100% {
			        bottom: -0.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(180deg);
			                transform: scale(0.3) rotate(180deg);
			    }
			}
			 
			@-webkit-keyframes drop4anim {
			    0% {
			        left: 3.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(-90deg);
			                transform: scale(0.3) rotate(-90deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(-90deg);
			                transform: scale(1) rotate(-90deg);
			    }
			    100% {
			        left: -0.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(-90deg);
			                transform: scale(0.3) rotate(-90deg);
			    }
			}
			 
			@keyframes drop4anim {
			    0% {
			        left: 3.75em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(-90deg);
			                transform: scale(0.3) rotate(-90deg);
			    }
			    25% {
			        opacity: 0;
			    }
			    50% {
			        opacity: 1;
			        -webkit-transform: scale(1) rotate(-90deg);
			                transform: scale(1) rotate(-90deg);
			    }
			    100% {
			        left: -0.25em;
			        opacity: 0;
			        -webkit-transform: scale(0.3) rotate(-90deg);
			                transform: scale(0.3) rotate(-90deg);
			    }
			}
		</style>
	</head>
	<body scroll="no">
		<div id="container">
		  <div class="firework-grp">
		      <div class="firework pos1 ">
		          <div class="drops-grp">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		          <div class="drops-grp drops-grp2">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		      </div>
		      <div class="firework pos2 delay1">
		          <div class="drops-grp">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		          <div class="drops-grp drops-grp2">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		      </div>
		      <div class="firework pos3 delay2">
		          <div class="drops-grp">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		          <div class="drops-grp drops-grp2">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		      </div>
		      <div class="firework pos4 ">
		          <div class="drops-grp">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		          <div class="drops-grp drops-grp2">
		              <span class="drop drop-1"></span>
		              <span class="drop drop-2"></span>
		              <span class="drop drop-3"></span>
		              <span class="drop drop-4"></span>
		          </div>
		      </div>
		  </div>
		</div>
		<button onclick="tooglePlay()" style="position: fixed;">打开声音</button >
		<!--舞台-->
		<div id="stage">
		
		<!--年兽-->
		<div id="monster"  class="monster">
			
		</div>
		<!--发射器-->
		<div id="Launcher">
			<div id="LauncherHead"></div>
		</div>
		
		</div>
		<script>
		//获取元素
		var wx = window.innerWidth; //窗口宽度
		var wy = window.innerHeight; //窗口高度
		var stage = document.getElementById('stage');
		stage.style.height= wy + 'px'
		//stage.style.backgroundColor = "#F08080"
		var monster = document.getElementById('monster'); //年兽
		var monsterX = 100; // 移动距离
		var monsterY = lastMonsterY; // 移动高度
		var lastMonsterY = 30;
		var monsterSpeed = 1; // 移动速度
		var monsterDown = wy/2  * Math.random(); //落点
		var mosterIsMove = true; //年兽是否移动
		var Launcher = document.getElementById('Launcher'); //发射器
		var rect = Launcher.getBoundingClientRect();
		var LauncherX = rect.left + (rect.right - rect.left) / 2;
		var LauncherY =	rect.bottom;
		var x = 0;
		var y = 0;
		var l = 0;
		var t = 0;
		//获取x和y
		var nx = LauncherX;
		var ny;
		var progress = 0;
		var isDown = false; //鼠标是否在按下
		var isPlay = false; //是否播放
		var lastBulletTime = 0; // 上次发射子弹时间
		var frequency = 5; // 发射子弹频率
		var bulletSpeed = 10; // 子弹飞行速度
		var createBulletInterval = null; // 创建子弹的定时器
		var rotation = 0 ;// 发射角度
		(function animloop() {
		        monsterMove();
				createBullet();
		        window.requestAnimationFrame(animloop);
			
		})();
		function easeInOutExpo(x) {
		    return x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ? Math.pow(2, 20 * x - 8) / 2 : (2 - Math.pow(2, -20 * x + 10)) / 2;
		}
		//年兽移动
		function monsterMove(){
			// 更新游戏时间
			//this.gameDuration = new Date().getTime() - this.gameBeginTime
			
			if(mosterIsMove){
				monsterX += monsterSpeed;
				progress = parseInt((monsterX + 100)/wx * 100)
				if(progress>0 && progress<=30){
					monsterSpeed = 1
					monsterY = 130
				}
				if(progress>30 && progress<=70){
					monsterSpeed = easeInOutExpo(progress/100)*10
					monsterY = 130 + easeInOutExpo((progress-30)/40) * 100
				}
				
				if(monsterX + 100 >= wx){
					
					mosterIsMove = false;
				}
			}else{
				monsterX += -monsterSpeed;
				progress = parseInt((wx - monsterX)/(wx - 100) * 100)
				if(progress>0 && progress<=30){
					monsterY = 230
				}
				if(progress>30 && progress<=70){
					monsterSpeed = easeInOutExpo(progress/100)*10
					monsterY = 230 - easeInOutExpo((progress-30)/40) * 100
				}
				
				if(monsterX<=100){
					
					mosterIsMove = true;
				}
			}
			
			monster.style.left= monsterX +'px'
			monster.style.top = monsterY +'px'
		}
		//鼠标按下事件
		function down(e){
			 //获取x坐标和y坐标
			if(e.touches){
			    let touch = e.touches[0];
				x = touch.clientX;
				y = touch.clientY;
			}else{
				x = e.clientX;
				y = e.clientY;
			}
			e.preventDefault();
		    //获取左部和顶部的偏移量
		    l = Launcher.offsetLeft;
		    t = Launcher.offsetTop;
		    //开关打开
		    isDown = true;
		    //设置样式  
		    Launcher.style.cursor = 'move';
		}
		//鼠标移动
		function move(e){
			e.preventDefault();
		    if (isDown == false) {
		        return;
		    }
			if(e.touches){
			    let touch = e.touches[0];
				nx = touch.clientX;
				ny = touch.clientY;
			}else{
				nx = e.clientX;
				ny = e.clientY;
			}
			dx = nx-LauncherX;
			dy = ny-LauncherY; 
			rotation = (Math.atan2(dy, dx) * 180 / Math.PI) + 90;
			// 只能在 -45 ， 45 间移动
			if(rotation<=-45 || rotation >180){
				rotation = -45
			}else if(rotation >=45 && rotation <180){
				rotation = 45
			}
			//console.log(rotation)
			Launcher.style['transform'] = Launcher.style['-webkit-transform'] = 'rotate(' + rotation + 'deg)'
		    //计算移动后的左偏移量和顶部的偏移量
		    //var nl = nx - (x - l);
		    //var nt = ny - (y - t);
		    //Launcher.style.left = nl + 'px';
		    //Launcher.style.top = nt + 'px';
		}
		//鼠标抬起事件
		function up(){
		    //开关关闭
		    isDown = false;
		    Launcher.style.cursor = 'default';
		}
		
		Launcher.onmousedown = function(e){
			down(e)
		}
		
		window.onmousemove = function(e){
			move(e)
		}
		
		window.onmouseup = function(){
			up()
		}
		window.addEventListener('touchstart',function(e){
			down(e)
		},{ passive: false });
		window.addEventListener('touchmove',function(e){
			move(e)
		},{ passive: false });
		window.addEventListener('touchend',function(){
			up()
		},{ passive: false });
		function tooglePlay() {
			window.backMusic = new Audio()
			// window.backMusic.src = require('../assets/mp3/back.mp3')
			// window.backMusic.loop = true
			// window.backMusic.load()
			// window.backMusic.currentTime = 127.2 // 背景音乐默认定位到舒缓片段
			if (!isPlay) {
				window.backMusic.play()
				isPlay = true
			} else {
				window.backMusic.pause()
				isPlay = false
			}
		};
		function playAudio(src) {
			if (isPlay) {
				const audio = new Audio()
				audio.src = src
				audio.load()
				audio.volume = .5
				audio.play()
			}
		};
		//生成子弹
		function createBullet () {
		      // 子弹
		      var now = new Date().getTime()
		      if (now - lastBulletTime > (1000 / frequency)) {
				
		        var bullet = document.createElement('div');
		        bullet.className = 'bullet';
				//console.log(Launcher.offsetHeight)
				//console.log(Launcher.offsetHeight * Math.cos(rotation/180 * Math.PI))
				//console.log(Launcher.offsetHeight * Math.sin(rotation/180 * Math.PI))
				bullet.style['transform'] = bullet.style['-webkit-transform'] = 'rotate(' + rotation + 'deg)'
		        bullet.style.left = LauncherX + Launcher.offsetHeight * Math.cos((90 - rotation)/180 * Math.PI) + 'px';//rotation == 0 ? LauncherX + 'px': rotation < 0 ? LauncherX - Math.sqrt(Math.pow(Launcher.offsetHeight * Math.sin(rotation/180 * Math.PI),2) + Math.pow(Launcher.offsetHeight,2) - 2 * Launcher.offsetHeight * Math.sin(rotation/180 * Math.PI) * Launcher.offsetHeight * Math.cos(rotation/180 * Math.PI)) + 'px':LauncherX + Math.sqrt(Math.pow(Launcher.offsetHeight * Math.sin(rotation/180 * Math.PI),2) + Math.pow(Launcher.offsetHeight,2) - 2 * Launcher.offsetHeight * Math.sin(rotation/180 * Math.PI) * Launcher.offsetHeight * Math.cos(rotation/180 * Math.PI)) + 'px';
				bullet.style.top =  rotation < 0? wy - Launcher.offsetHeight - (Launcher.offsetHeight - 56) * Math.sin(rotation/180 * Math.PI) + 'px' : wy - Launcher.offsetHeight + (Launcher.offsetHeight - 56) * Math.sin(rotation/180 * Math.PI) + 'px'; // 
				bullet.speen = rotation * .2
				stage.appendChild(bullet);
				playAudio('image/pu.mp3');
		        // 子弹移动
		        function bulletMove(){
		            bullet.style.top = bullet.offsetTop - bulletSpeed + 'px'
					if(rotation>=-75 && rotation <0){
						bullet.style.left = bullet.offsetLeft +  bullet.speen + 'px'
					}
					if(rotation == 0){
						bullet.style.left = bullet.offsetLeft + 'px'
					}
					if(rotation >0 && rotation <75){
						bullet.style.left = bullet.offsetLeft +  bullet.speen + 'px'
					}		
					//bullet.style.left = bullet.offsetLeft + 1 + 'px'
		          // 如果子弹距离顶部的距离为年兽的高度时，判断子弹和年兽的水平位置是否重合
		          if (bullet.offsetTop <= monster.offsetTop + monster.offsetHeight && bullet.offsetTop >= monster.offsetTop && bullet.offsetLeft >= monsterX  && bullet.offsetLeft <= monsterX + monster.offsetWidth) { //&& bullet.offsetLeft >= monsterX  && bullet.offsetLeft <= monsterX + monster.offsetWidth
		            // 年兽掉血
		            //this.nianshouHP -= this.damage
		            playAudio('image/boom.wav');
		            // if (this.nianshouHP <= 0) {
		            //   this.nianshouHP = 0
		            //   this.gameOver()
		            // }
		            // 子弹消失
					var imgF = document.createElement('div');
					imgF.className = 'imgF';
					imgF.style.left = bullet.offsetLeft + 'px';
					imgF.style.top = bullet.offsetTop + 'px';
					stage.appendChild(imgF);
					monster.style.backgroundColor = "#FFE395";
					monsterSpeed = .5;
					setTimeout(function(){
						monster.style.backgroundColor = "red"
						monsterSpeed = 1;
						stage.removeChild(imgF)
					}, 650); 
		            stage.removeChild(bullet)
		            window.cancelAnimationFrame(bulletMove)
		          } else if (bullet.offsetTop <= 0) {
		            stage.removeChild(bullet)
		            window.cancelAnimationFrame(bulletMove)
		          } else {
		            window.requestAnimationFrame(bulletMove)
		          }
		        }
		        bulletMove()
		        lastBulletTime = now
		      }
		    };
		
		
	
		</script>
	</body>
</html>
